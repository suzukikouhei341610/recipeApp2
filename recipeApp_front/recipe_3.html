<!DOCTYPE html>
<html lang="ja">
<head>
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/@mdi/font@6.x/css/materialdesignicons.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet">
  <link rel="stylesheet" href="recipe_style.css">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ãƒã‚«ãƒ­ãƒ³ | ãŠè“å­ãƒ¡ãƒ¼ã‚«ãƒ¼</title>
</head>
<body>
  <div id="app">
    <v-app>
      <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
      <header class="app-header">ğŸ°ãŠã¡ã‚ƒã‚‰ã‘å¤©ä½¿ã®ãŠè“å­ãƒ¬ã‚·ãƒ”ğŸ‚</header>

      <div class="title-container">
        <h1>ãƒã‚«ãƒ­ãƒ³</h1>
      </div>

      <v-row class="outline">
        <!-- ç”»åƒéƒ¨åˆ† -->
        <v-col cols="7" class="recipe-photo">
          <img class="recipe-photo" src="https://images.pexels.com/photos/7296682/pexels-photo-7296682.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2" alt="ãƒã‚«ãƒ­ãƒ³ã®ç”»åƒ">
        </v-col>

        <!-- ãƒ¬ã‚·ãƒ”æƒ…å ±éƒ¨åˆ† -->
        <v-col cols="5">
          <div class="recipe-info">
            <!-- ãŠæ°—ã«å…¥ã‚Šãƒœã‚¿ãƒ³ -->
            <v-btn
              v-if="!isFavorite"
              color="amber accent-3"
              @click="addToFavorite"
              class="favorite-btn">
              <v-icon>mdi-star-outline</v-icon> ãŠæ°—ã«å…¥ã‚Šã«è¿½åŠ 
            </v-btn>

            <v-btn
              v-else
              color="amber accent-3"
              @click="deleteFromFavorite"
              class="favorite-btn">
              <v-icon>mdi-star</v-icon> ãŠæ°—ã«å…¥ã‚Šã‹ã‚‰å‰Šé™¤
            </v-btn>

            <p><strong>ã‚«ãƒ†ã‚´ãƒªãƒ¼:</strong> ãƒã‚«ãƒ­ãƒ³</p>
            <p><strong>èª¿ç†æ™‚é–“:</strong> 60åˆ†</p>
            <p><strong>ä½¿ç”¨å•†å“:</strong> ãŠã¡ã‚ƒã‚‰ã‘ãƒãƒ§ã‚³(ãƒŸãƒ«ã‚¯)ã€ãŠã¡ã‚ƒã‚‰ã‘ãƒãƒ§ã‚³(ãƒ–ãƒ©ãƒƒã‚¯)</p>
          </div>
        </v-col>
      </v-row>

      <v-row class="details">
        <!-- ææ–™éƒ¨åˆ† -->
        <v-col cols="5" class="ingredients">
          <h2>ææ–™</h2>
          <ul>
            <li>ã‚³ã‚³ã‚¢ãƒ‘ã‚¦ãƒ€ãƒ¼ 10g</li>
            <li>åµç™½ 2å€‹åˆ†</li>
            <li>ã‚°ãƒ©ãƒ‹ãƒ¥ãƒ¼ç³– 30g</li>
            <li>ã‚¢ãƒ¼ãƒ¢ãƒ³ãƒ‰ãƒ‘ã‚¦ãƒ€ãƒ¼ 80g</li>
            <li>ç²‰ç³– 130g</li>
          </ul>
          <p><strong>â˜†ã‚¬ãƒŠãƒƒã‚·ãƒ¥:</strong> ãƒ–ãƒ©ãƒƒã‚¯ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆ 50gã€ãƒŸãƒ«ã‚¯ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆ 50gã€ç”Ÿã‚¯ãƒªãƒ¼ãƒ  100mlã€ãŠå¥½ã¿ã§ãƒ–ãƒ©ãƒ³ãƒ‡ãƒ¼ 5ml</p>
        </v-col>

        <!-- æ‰‹é †éƒ¨åˆ† -->
        <v-col cols="7" class="steps">
          <h2>æ‰‹é †</h2>
          <ol>
            <li>ä¸‹æº–å‚™
              <ul>
                <li>ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆã‚’åˆ»ã‚“ã§ãŠãã€‚</li>
                <li>åµç™½ã¯å†·ã‚„ã™ã€‚</li>
                <li>ç²‰é¡ã‚’ãµã‚‹ã†ã€‚</li>
                <li>ã‚ªãƒ¼ãƒ–ãƒ³ã‚’130â„ƒã«äºˆç†±ã€‚</li>
              </ul>
            </li>
            <li>ãƒã‚«ãƒ­ãƒ³ã®åœŸå°
              <ul>
                <li>åµç™½ã¨ã‚°ãƒ©ãƒ‹ãƒ¥ãƒ¼ç³–ã§ãƒ¡ãƒ¬ãƒ³ã‚²ã‚’ä½œã‚‹ã€‚</li>
                <li>ç²‰é¡ã‚’åŠ ãˆã¦ç”Ÿåœ°ã‚’ä½œã‚‹ã€‚</li>
                <li>çµã‚Šè¢‹ã§æˆå½¢ã€‚</li>
                <li>30åˆ†ä»¥ä¸Šä¹¾ç‡¥ã€‚</li>
                <li>130â„ƒã§20åˆ†ã€170â„ƒã§3åˆ†ç„¼ãã€‚</li>
              </ul>
            </li>
            <li>ã‚¬ãƒŠãƒƒã‚·ãƒ¥
              <ul>
                <li>ç”Ÿã‚¯ãƒªãƒ¼ãƒ ã‚’æ²¸é¨°ã•ã›ã€ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆã«åŠ ãˆã‚‹ã€‚</li>
                <li>æ··ãœã¦å†·ã‚„ã—ã€ã‚‚ã£ãŸã‚Šã—ãŸã‚‰å®Œæˆã€‚</li>
              </ul>
            </li>
            <li>ä»•ä¸Šã’
              <ul>
                <li>ã‚¬ãƒŠãƒƒã‚·ãƒ¥ã‚’æŒŸã‚“ã§å®Œæˆã€‚</li>
              </ul>
            </li>
          </ol>
        </v-col>
      </v-row>

      <!-- æˆ»ã‚‹ãƒœã‚¿ãƒ³ -->
      <v-col cols="12" class="btn-col">
        <v-btn @click="navigate()" class="recipe_btn btn">æˆ»ã‚‹</v-btn>
      </v-col>
    </v-app>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    new Vue({
      el: '#app',
      vuetify: new Vuetify(),
      data() {
        return {
          isFavorite: false
        };
      },
      async mounted() {
        await this.checkIfFavorite();
      },
      methods: {
        async getUserId() {
          const user_name = sessionStorage.getItem('user_name');
          if (user_name) {
            try {
              const loginResponse = await fetch(`https://m3h-kouhei-2010.azurewebsites.net/api/LOGINIDSELECT?user_name=${user_name}`);
              const userIds = await loginResponse.json();
              if (userIds.length === 0) {
                console.error('ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚');
              }
              return userIds[0];
            } catch (error) {
              console.error('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
            }
          }
        },
        async addToFavorite() {
          const user_id = await this.getUserId();
          const recipe_id = sessionStorage.getItem("recipe_id");
          const favoritedata = { user_id, recipe_id };

          if (user_id && recipe_id) {
            try {
              const response = await axios.post("https://m3h-kouhei-2010.azurewebsites.net/api/FAVORITEINSERT", favoritedata);
              if (response.status === 200) {
                this.isFavorite = true;
              }
            } catch (error) {
              console.error("ã‚¨ãƒ©ãƒ¼:", error);
            }
          }
        },
        async deleteFromFavorite() {
          const user_id = await this.getUserId();
          const recipe_id = sessionStorage.getItem("recipe_id");

          if (user_id && recipe_id) {
            try {
              const response = await axios.post("https://m3h-kouhei-2010.azurewebsites.net/api/FAVORITEDELETE", { user_id, recipe_id });
              if (response.status === 200) {
                this.isFavorite = false;
              }
            } catch (error) {
              console.error("ã‚¨ãƒ©ãƒ¼:", error);
            }
          }
        },
        async checkIfFavorite() {
          const user_id = await this.getUserId();
          const recipe_id = sessionStorage.getItem("recipe_id");

          if (user_id && recipe_id) {
            try {
              const response = await axios.get(`https://m3h-kouhei-2010.azurewebsites.net/api/CHECKIFFAVORITE?user_id=${user_id}&recipe_id=${recipe_id}`);
              this.isFavorite = response.data.isFavorite;
            } catch (error) {
              console.error('Error:', error);
            }
          }
        },
        navigate() {
          window.location.href = 'home.html';
        }
      }
    });
  </script>
</body>
</html>
