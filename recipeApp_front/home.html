<!DOCTYPE html>
<html>
    <head>
        <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/@mdi/font@6.x/css/materialdesignicons.min.css" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet">
        <link rel="stylesheet" href="style.css">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
        <meta charset="UTF-8">
        <title>Home</title>
        <style>

        </style>
    </head>
    <body>
        <div id="app">
            <v-app>
                <v-app-bar>
                
                <v-toolbar-title>recipe app</v-toolbar-title>
                <v-spacer></v-spacer>
                    <!-- <v-btn onclick="window.location.href = 'home.html';">Home</v-btn> | -->
                    <v-btn onclick="window.location.href = 'mypage.html';">my page</v-btn> |
                    <v-btn @click="logout()">logout</v-btn>
                    <!-- <v-btn onclick="window.location.href = 'index.html';">logout</v-btn> -->
                </v-app-bar>
                

                <div class="search-app">
                    <h1>レシピ検索</h1>
            
                    <form @submit.prevent="searchRecipes">
                    <div>
                        <label for="recipe_category">レシピカテゴリー:</label>
                        <input type="text" id="recipe_category" v-model="recipeCategory" />
                    </div>
                    <!-- <div>
                        <label for="recipe_time">調理時間:</label>
                        <input type="text" id="recipe_time" v-model="recipeTime" />
                    </div> -->
                    <div>
                        <label for="recipe_scene">シーン:</label>
                        <input type="text" id="recipe_scene" v-model="recipeScene" />
                    </div>
                    <button type="submit" class="btn-search">検索</button> <!-- 検索ボタンのスタイリング -->
                    </form>
            
                    <div v-if="recipes.length > 0">
                    <h2>検索結果</h2>
                    <table class="result-table"> <!-- テーブルのスタイリング -->
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>レシピ名</th>
                                <th>カテゴリー</th>
                                <th>調理時間</th>
                                <th>シーン</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="recipe in recipes" :key="recipe.RecipeID">
                                <td>{{ recipe.RecipeID }}</td>
                                <td>
                                <a @click="goToDetail(recipe.RecipeID)">{{ recipe.RecipeName }}</a>
                                </td>
                                <td>{{ recipe.RecipeCategory1 }}</td>
                                <td>{{ recipe.RecipeTime }} 分</td>
                                <td>{{ recipe.RecipeScene1 }}</td>
                            </tr>
                        </tbody>
                    </table>
                    </div>
                    <div v-else>
                        <p>検索結果がありません。</p>
                    </div>
                </div>

            <v-row>
                <v-col v-for="(item,index) in dataList" :key="index" cols="12" sm="6" md="4">
                    <v-card
                    class="mx-auto"
                    max-width="400"
                    outlined>

                    <v-img
                        class="white--text align-end"
                        height="200px"
                        :src="encodeURI(item.recipe_photo) || 'recipeApp2\recipeApp_front\images\no image.jpg'"
                        alt="Recipe Image">
                    <v-card-title>
                        <span class="headline"></span>
                    </v-card-title>
                    </v-img>

                
                    <v-card-subtitle class="card-subtitle">
                        {{ item.recipe_name }}
                    </v-card-subtitle>
                
                    <v-card-text class="card-recipe-time">                          
                        <div>調理時間: {{ item.recipe_time }}分</div>
                    </v-card-text>
                
                    <!-- <v-card-actions>
                        <v-btn color="orange" text>favorite</v-btn>
                    </v-card-actions> -->
                    </v-card>
                </v-col>
            </v-row>
            </v-app>
        </div>
        
        <script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        
        <script>
            new Vue({
            el: '#app',
            vuetify: new Vuetify(),
            data() {
                return {
                recipeCategory: "",
                recipeTime: "",
                recipeScene: "",
                recipes: [],
                dataList: []//一覧用
                };
            },
            methods: {
                async searchRecipes() {
                try {
                    const response = await axios.get("https://m3h-kouhei-2010.azurewebsites.net/api/SEARCH", {
                    params: {
                        recipe_category: this.recipeCategory,
                        recipe_time: this.recipeTime,
                        recipe_scene: this.recipeScene
                    }
                    });
                    this.recipes = response.data;
                } catch (error) {
                    console.error("検索中にエラーが発生しました:", error);
                    alert("検索中にエラーが発生しました。");
                }
                },
                
                goToDetail(RecipeID){
                const url = `recipe_${RecipeID}.html`;
                window.location.href = url;
                },

                logout(){
                    //console.log('User Name saved:', sessionStorage.getItem('user_name'));//デバック用
                    sessionStorage.removeItem('user_name');
                    //console.log('User Name saved:', sessionStorage.getItem('user_name'));//デバック用
                    window.location.href = 'index.html';
                }
            },
            mounted() {
            axios.get('https://m3h-kouhei-2010.azurewebsites.net/api/RECIPESELECT')
                .then(response => {
                    this.dataList = response.data.List;
                    // `recipe_id` の重複をチェック
                    const ids = this.dataList.map(item => item.recipe_id);
                    const uniqueIds = new Set(ids);
                    if (ids.length !== uniqueIds.size) {
                        console.warn('Duplicate recipe_id detected:', ids);
                    }
                })
                .catch(error => {
                console.error('Error:', error);
                });
            }
            });
        </script>
    </body>
</html>