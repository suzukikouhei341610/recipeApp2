<!DOCTYPE html>
<html lang="ja">
<head>
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/@mdi/font@6.x/css/materialdesignicons.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet">
  <link rel="stylesheet" href="recipe_style.css">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã‚·ãƒ¥ãƒ¼ã‚¯ãƒªãƒ¼ãƒ ã‚¿ãƒ¯ãƒ¼ | ãŠè“å­ãƒ¡ãƒ¼ã‚«ãƒ¼</title>
</head>

<body>
  <div id="app">
    <v-app>
      <header>ğŸ°ãŠã¡ã‚ƒã‚‰ã‘å¤©ä½¿ã®ãŠè“å­ãƒ¬ã‚·ãƒ”ğŸ‚</header>

      <div class="title-container">
        <h1>ã‚·ãƒ¥ãƒ¼ã‚¯ãƒªãƒ¼ãƒ ã‚¿ãƒ¯ãƒ¼</h1>
      </div>

      <v-row class="outline">
        <v-col cols="7" class="recipe-photo">
          <img src="https://i.pinimg.com/564x/41/2e/0a/412e0a26e689262c712dcb33dc2e9139.jpg" class="recipe-photo"  alt="ã‚·ãƒ¥ãƒ¼ã‚¯ãƒªãƒ¼ãƒ ã‚¿ãƒ¯ãƒ¼ã®ç”»åƒ">
        </v-col>

        <v-col cols="5">
          <div class="recipe-info">
           
              <v-btn
              v-if="!isFavorite"
              color="amber accent-3"
              @click="addToFavorite"
              class="favorite-btn">
                <v-icon>mdi-star-outline</v-icon>
                ãŠæ°—ã«å…¥ã‚Šã«è¿½åŠ 
              </v-btn>
   
              <v-btn
              v-else
              color="amber accent-3"
              @click="deleteFromFavorite"
              class="favorite-btn">
                <v-icon>mdi-star</v-icon>
                ãŠæ°—ã«å…¥ã‚Šã‹ã‚‰å‰Šé™¤
              </v-btn>

            <p><strong>ã‚«ãƒ†ã‚´ãƒªãƒ¼:</strong> ãƒ›ãƒƒãƒˆã‚±ãƒ¼ã‚­ãƒŸãƒƒã‚¯ã‚¹</p>
            <p><strong>èª¿ç†æ™‚é–“:</strong> 90åˆ†</p>
            <p><strong>ä½¿ç”¨å•†å“:</strong> ãŠã¡ã‚ƒã‚‰ã‘ãƒ›ãƒƒãƒˆã‚±ãƒ¼ã‚­ãƒŸãƒƒã‚¯ã‚¹</p>
          </div>
        </v-col>
      </v-row>

      <v-row class="details">
        <v-col cols="5" class="ingredients">
          <h2>ææ–™:</h2>
          <ul>
            <li>ãƒ›ãƒƒãƒˆã‚±ãƒ¼ã‚­ãƒŸãƒƒã‚¯ã‚¹150g</li>
            <li>ç‰›ä¹³240g</li>
            <li>ãƒã‚¿ãƒ¼90g</li>
            <li>åµ3å€‹</li>
            <li>ã€ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã€‘<br>ãƒ›ã‚¤ãƒƒãƒ—ã‚¯ãƒªãƒ¼ãƒ ã‚„ã‚«ã‚¹ã‚¿ãƒ¼ãƒ‰ã‚¯ãƒªãƒ¼ãƒ é©é‡ã€ãŠå¥½ã¿ã®ã‚·ãƒ­ãƒƒãƒ—ã€ç²‰ç ‚ç³–é©é‡</li>
          </ul>
        </v-col>
      
        <v-col cols="7" class="steps">
          <h2>æ‰‹é †:</h2>
          <ol>
            <ul>å¤©æ¿ã«ã‚¯ãƒƒã‚­ãƒ³ã‚°ã‚·ãƒ¼ãƒˆã‚’æ•·ãã€ã‚ªãƒ¼ãƒ–ãƒ³ã¯200â„ƒã«äºˆç†±ã™ã‚‹ã€‚</ul>
            <ul>ç‰›ä¹³ãƒ»ãƒã‚¿ãƒ¼ã‚’è€ç†±ãƒœãƒ¼ãƒ«ã«å…¥ã‚Œã€é›»å­ãƒ¬ãƒ³ã‚¸500Wã§ç´„1åˆ†åŠ ç†±ã™ã‚‹ã€‚</ul>
            <ul>ãƒ›ãƒƒãƒˆã‚±ãƒ¼ã‚­ãƒŸãƒƒã‚¯ã‚¹ã‚’åŠ ãˆã¦ã‚ˆãæ··ãœã€é›»å­ãƒ¬ãƒ³ã‚¸500Wã§ç´„2åˆ†åŠåŠ ç†±ã—ãŸã‚ã¨æ›´ã«ã‚ˆãæ··ãœã‚‹ã€‚</ul>
            <ul>ã•ã‚‰ã«é›»å­ãƒ¬ãƒ³ã‚¸500Wã§ç´„1åˆ†ãšã¤åŠ ç†±ã—ã€å…¨ä½“ãŒã²ã¨ã‹ãŸã¾ã‚Šã«ãªã‚‹ã¾ã§æ··ãœåˆã‚ã›ã¦ã€åŠ ç†±ã‚’ç¹°ã‚Šè¿”ã™ã€‚</ul>
            <ul>3å€‹ã®åµã‚’å‰²ã‚Šã»ãã—ã€æº¶ãåµã‚’å°‘ã—ãšã¤åŠ ãˆã€ã‚´ãƒ ãƒ™ãƒ©ã§æ··ãœã‚‹ã€‚<br>
              â€»ç”Ÿåœ°ã®å›ºã•ã®ç›®å®‰:ã‚´ãƒ ãƒ™ãƒ©ã§ç”Ÿåœ°ã‚’æŒã¡ä¸Šã’ã¦å°‘ã—è½ã¨ã—ãŸéš›ã«ã€<br>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ ã‚´ãƒ ãƒ™ãƒ©å´ã«æ®‹ã£ãŸç”Ÿåœ°ãŒé€†ä¸‰è§’ã®å½¢ã§æ®‹ã‚‹ç¨‹åº¦</ul>
            <ul>ã‚·ãƒ¥ãƒ¼ç”Ÿåœ°ã‚’ã‚¹ãƒ—ãƒ¼ãƒ³ã§ã‚¯ãƒƒã‚­ãƒ³ã‚°ã‚·ãƒ¼ãƒˆã‚’æ•·ã„ãŸå¤©æ¿ã®ä¸Šã«è½ã¨ã—ã€é–“éš”ã‚’ã‚ã‘ã¦ä¸¦ã¹ã‚‹ã€‚</ul>
            <ul>ä¸¦ã¹ãŸç”Ÿåœ°ã«ã€ãŸã£ã·ã‚Šéœ§å¹ãã§æ°´åˆ†ã‚’å«ã¾ã›ã‚‹ã€‚</ul>
            <ul>äºˆç†±ã—ã¦ãŠã„ãŸ200â„ƒã®ã‚ªãƒ¼ãƒ–ãƒ³ã§ç´„10åˆ†ã€170â„ƒã«ä¸‹ã’ã¦ã•ã‚‰ã«ç´„20åˆ†ç„¼ãã€‚</ul>
            <ul>ã‚·ãƒ¥ãƒ¼ç”Ÿåœ°ã®åº•ã«ç©´ã‚’ã‚ã‘ã€ä¸­ã«ãƒ›ã‚¤ãƒƒãƒ—ã‚¯ãƒªãƒ¼ãƒ ã‚„ã‚«ã‚¹ã‚¿ãƒ¼ãƒ‰ã‚¯ãƒªãƒ¼ãƒ ã‚’å…¥ã‚Œã‚‹ã€‚</ul>
            <ul>ãŠå¥½ã¿ã®ã‚·ãƒ­ãƒƒãƒ—ã‚’ã‚·ãƒ¥ãƒ¼ã«å¡—ã‚Šã€ã‚¿ãƒ¯ãƒ¼ã®ã‚ˆã†ã«ç©ã¿ä¸Šã’ã‚‹ã€‚</ul>
            <ul>ã‚¯ãƒªãƒ¼ãƒ ã‚„ç²‰ç ‚ç³–ãªã©ã§ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã—ã¦å®Œæˆã€‚</ul>
          </ol>
        </v-col>
      </v-row>
      <!-- <v-container>
        <v-btn color="primary" @click="addToFavorite">
          ãŠæ°—ã«å…¥ã‚Šã«è¿½åŠ 
        </v-btn>
      </v-container>
      <v-container>
        <v-btn color="primary" @click="deleteFromFavorite">
          ãŠæ°—ã«å…¥ã‚Šã‹ã‚‰å‰Šé™¤
        </v-btn>
      </v-container> -->
 
      <v-col cols="12" class="btn-col">
        <v-btn @click="navigate()" class="recipe_btn btn">æˆ»ã‚‹</v-btn>
      </v-col>
    </v-app>
  </div>
 
  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
 
  <script>
    new Vue({
        el: '#app',
        vuetify: new Vuetify(),
        data() {
          return {
            isFavorite: false, // åˆæœŸçŠ¶æ…‹ã¯ãŠæ°—ã«å…¥ã‚Šã§ãªã„
            nextId: null
          };
        },
 
        async mounted() {
          await this.checkIfFavorite();
        },
 
        methods: {
          // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®user_nameã‹ã‚‰user_idã‚’ã¨ã£ã¦ãã‚‹
          async getUserId() {
            const user_name = sessionStorage.getItem('user_name');
            if (user_name) {
              try {
                const loginResponse = await fetch(`https://m3h-kouhei-2010.azurewebsites.net/api/LOGINIDSELECT?user_name=${user_name}`);
                const userIds = await loginResponse.json();
                if (userIds.length === 0) {
                  console.error('ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚');
                  return null;
                }
                const user_id = userIds[0];
                return user_id;
              } catch (error) {
                console.error('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
                return null;
              }
            } else {
              console.error('ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«user_nameãŒä¿å­˜ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');
              return null;
            }
          },
 
          async readNextFavoriteId() {
            try {
              const response = await axios.get('https://m3h-kouhei-2010.azurewebsites.net/api/FAVORITEALLSELECT');
              console.log('Response:', response);
              console.log('Response data:', response.data);
              console.log('response.data.List:', response.data.List);
 
              if (response.data && response.data.List) {
                const ids = response.data.List.map(favoriteid => Number(favoriteid.favorite_id));
                this.nextId = ids.length ? Number(Math.max(...ids) + 1) : 1;
                console.log('Next ID:', this.nextId);
              } else {
                console.error('Unexpected response format:', response.data);
              }
            } catch (error) {
              console.error('Error fetching data:', error);
            }
          },
 
          async addToFavorite() {
            await this.readNextFavoriteId();
            const favorite_id = Number(this.nextId);
            const user_id = await this.getUserId();
            const recipe_id = sessionStorage.getItem("recipe_id");
 
            const favoritedata = {
              favorite_id: favorite_id,
              user_id: user_id,
              recipe_id: recipe_id
            }
 
            console.log('User ID :', user_id); // ãƒ‡ãƒãƒƒã‚°ç”¨ãƒ­ã‚°
            console.log('Recipe ID from sessionStorage:', recipe_id); // ãƒ‡ãƒãƒƒã‚°ç”¨ãƒ­ã‚°
            console.log('Favorite ID :', favorite_id);
 
            if (user_id && recipe_id) {
              try {
                const response = await axios.post("https://m3h-kouhei-2010.azurewebsites.net/api/FAVORITEINSERT", favoritedata, {
                  headers: {
                    "Content-Type": "application/json"
                  }
                });
 
                if (response.status === 200) {
                  console.log('ãŠæ°—ã«å…¥ã‚Šã«è¿½åŠ ã—ã¾ã—ãŸï¼');
                  this.isFavorite = true; // çŠ¶æ…‹ã‚’æ›´æ–°
                } else {
                  console.error('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
                }
              } catch (error) {
                console.error("ã‚¨ãƒ©ãƒ¼:", error);
              }
            } else {
              console.error("ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã¾ãŸã¯ãƒ¬ã‚·ãƒ”IDãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚");
            }
          },
 
          async deleteFromFavorite() {
            const user_id = await this.getUserId();
            const recipe_id = sessionStorage.getItem("recipe_id");
           
            console.log('User ID:', user_id); // ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’è¡¨ç¤º
            console.log('Recipe ID:', recipe_id); // ãƒ¬ã‚·ãƒ”IDã‚’è¡¨ç¤º
 
            if (user_id && recipe_id) {
              try {
                const response = await axios.post("https://m3h-kouhei-2010.azurewebsites.net/api/FAVORITEDELETE", {
                  user_id: user_id,
                  recipe_id: recipe_id
                }, {
                  headers: {
                    "Content-Type": "application/json"
                  }
                });
 
                if (response.status === 200) {
                  console.log('ãŠæ°—ã«å…¥ã‚ŠãŒè§£é™¤ã•ã‚Œã¾ã—ãŸï¼');
                  this.isFavorite = false; // çŠ¶æ…‹ã‚’æ›´æ–°
                  alert('ãŠæ°—ã«å…¥ã‚ŠãŒè§£é™¤ã•ã‚Œã¾ã—ãŸã€‚');
                } else {
                  console.error('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
                  alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
                }
              } catch (error) {
                console.error("ã‚¨ãƒ©ãƒ¼:", error);
                alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
              }
            } else {
              console.error("ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã¾ãŸã¯ãƒ¬ã‚·ãƒ”IDãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚");
              alert('ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã¾ãŸã¯ãƒ¬ã‚·ãƒ”IDãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚');
            }
          },
 
          async checkIfFavorite() {
            const user_id = await this.getUserId();
            const recipe_id = sessionStorage.getItem("recipe_id");
           
            console.log('User ID:', user_id); // ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’è¡¨ç¤º
            console.log('Recipe ID:', recipe_id); // ãƒ¬ã‚·ãƒ”IDã‚’è¡¨ç¤º
 
            if (user_id && recipe_id) {
            try {
              const response = await axios.get(`https://m3h-kouhei-2010.azurewebsites.net/api/CHECKIFFAVORITE?user_id=${user_id}&recipe_id=${recipe_id}`);
              const isFavorite = response.data.isFavorite;  // APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‹ã‚‰isFavoriteã‚’å–å¾—              
             
              // ãŠæ°—ã«å…¥ã‚ŠçŠ¶æ…‹ã«å¿œã˜ã¦ãƒœã‚¿ãƒ³ã‚’åˆ‡ã‚Šæ›¿ãˆ
              this.isFavorite = isFavorite;
                    console.log('ãŠæ°—ã«å…¥ã‚ŠçŠ¶æ…‹:', this.isFavorite);
                  } catch (error) {
                    console.error('Error checking favorite status:', error);
                  }
                } else {
                  console.error('ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã¾ãŸã¯ãƒ¬ã‚·ãƒ”IDãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚');
                }
              },
              navigate() {
              window.location.href = 'home.html';
            }
            }
      });
    </script>
  </body>
</html>