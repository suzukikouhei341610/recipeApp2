<!DOCTYPE html>
<html>
    <head>
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@6.x/css/materialdesignicons.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
    <meta charset="UTF-8">
    <title>recipe app mypage</title>

                <v-toolbar-title>recipe app</v-toolbar-title>
          
                <v-spacer></v-spacer>
                    
                <v-btn onclick="window.location.href = 'home.html';">Home</v-btn> |
                <v-btn onclick="window.location.href = 'mypage.html';">my page</v-btn> |
                <v-btn onclick="window.location.href = 'index.html';">logout</v-btn>

    </head>
    
    <body>
    <div id="app">
        <v-app>
            <v-main>
                <v-container>
                    <div>こんにちは、</div>

                    <v-tabs v-model="tab">
                      <v-tab>お気に入り一覧</v-tab>
                      <v-tab>検索履歴</v-tab>
                    </v-tabs>
                
                    <v-tabs-items v-model="tab">
                      <!-- お気に入り一覧 -->
                      <v-tab-item>
                        <v-row>
                            <v-col v-for="item in dataList" :key="item.recipe_id" cols="12" sm="6" md="4">
                              <v-card 
                              class="mx-auto" 
                              max-width="400" 
                              outlined>

                              <v-img
                                class="white--text align-end"
                                height="200px"
                                :src="encodeURI(item.recipe_photo)"
                                alt="Recipe Image">
                              <v-card-title>

                                <span class="headline">{{ item.recipe_name }}</span>
                              </v-card-title>
                              </v-img>

                          
                              <v-card-subtitle class="card-subtitle">
                                sub-title
                              </v-card-subtitle>
                          
                              <v-card-text class="card-recipe-time">                          
                                <div>調理時間: {{ item.recipe_time }}</div>
                              </v-card-text>
                          
                              <v-card-actions>
                                <v-btn @click="saveToSessionStorage('recipe_id', 'user_id')"
                                  color="orange"
                                  text
                                >
                                  favorite
                                </v-btn>
                              </v-card-actions>
                            </v-card>


                      </v-tab-item>
                
                      <!-- 検索履歴 -->
                      <v-tab-item>
                        <v-card flat>
                          <v-card-title>検索履歴</v-card-title>
                          <v-card-text>
                            <!-- 検索履歴のコンテンツをここに追加 -->
                          </v-card-text>
                        </v-card>
                      </v-tab-item>
                    </v-tabs-items>
                  </v-container>
                


            </v-main>
        </v-app>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        var storage = sessionStorage;
        var value = sessionStorage.getItem('user_id');

        async function fetchFavorites(userName) {
    try {
        // 1. LoginIdSelect APIを呼び出してuser_idを取得
        const loginResponse = await fetch(`https://m3h-kouhei-2010.azurewebsites.net/api/LOGINIDSELECT?user_name=${userName}`);
        const userIds = await loginResponse.json();

        if (userIds.length === 0) {
            console.error('ユーザーが見つかりませんでした。');
            return;
        }

        const userId = userIds[0]; // 最初のuser_idを取得

        // 2. FavoriteSelect APIを呼び出してお気に入り一覧を取得
        const favoriteResponse = await fetch(`https://m3h-kouhei-2010.azurewebsites.net/api/FAVORITESELECT?user_id=${userId}`);
        const favorites = await favoriteResponse.json();

        // 3. お気に入りリストの表示
        favorites.List.forEach(item => {
            console.log(`Favorite ID: ${item.favorite_id}, Recipe ID: ${item.recipe_id}`);
            // ここでHTMLに追加する処理などを行う
        });

    } catch (error) {
        console.error('エラーが発生しました:', error);
    }
}

// 例: ユーザー名を指定して、お気に入りリストを取得
fetchFavorites('your_user_name');

        new Vue({
        el: '#app',
        vuetify: new Vuetify(),
        data() {
        return {
          tab: 0, // 初期タブのインデックス
          dataList: [], // データ表示用配列
          searchHistory: ['検索履歴1', '検索履歴2', '検索履歴3'], // サンプルデータ
        };
        },

        mounted() {
            // VueインスタンスがマウントされたときにAPIからデータを取得
            this.fetchFavoritesFromSession();
        },
        methods: {
            async getUserId() {
                const userName = document.getElementById('user_name').value;
                if (userName) {
                    try {
                        const loginResponse = await fetch(`https://m3h-kouhei-2010.azurewebsites.net/api/LOGINIDSELECT?user_name=${userName}`);
                        const userIds = await loginResponse.json();
                        if (userIds.length === 0) {
                            console.error('ユーザーが見つかりませんでした。');
                            return;
                        }
                        const userId = userIds[0]; // 最初のuser_idを取得
                        sessionStorage.setItem('user_id', userId);
                        this.fetchFavoritesFromSession();
                    } catch (error) {
                        console.error('エラーが発生しました:', error);
                    }
                }
            },
            async fetchFavoritesFromSession() {
                const userId = sessionStorage.getItem('user_id');
                if (userId) {
                    try {
                        const favoriteResponse = await fetch(`https://m3h-kouhei-2010.azurewebsites.net/api/FAVORITESELECT?user_id=${userId}`);
                        const favorites = await favoriteResponse.json();
                        this.dataList = favorites.List;
                    } catch (error) {
                        console.error('エラーが発生しました:', error);
                    }
                }
            },
            saveToSessionStorage(key, value) {
                sessionStorage.setItem('recipe_id', 'user_id');
            }
        }
    });    
    </script>
    </body>
</html>



